#!/usr/bin/env elvish
t=""
if (eq 0 (count $args)) {
  @sites=(keys (from-json <~/.mpw.d/(get-env MPW_FULLNAME).mpsites.json)[sites])
  if (eq ?(tty -s) $ok) {
    t=(echo &sep="\n" $@sites | sk)
  } else {
    t=(echo &sep="\n" $@sites | rofi -dmenu -p 'Enter site: ' -width 25)
  }
} else {
  t=$args[0]
}
mpw -t x -M (gpg2 -d -q ~/sns/password.gpg) $t 2>/dev/null | xclip -sel c -r -l 1
